<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每周周报 - 安佑预混料</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "San Francisco", "Roboto", "Helvetica Neue", Arial, sans-serif;
            background-color: #ffffff;
            color: #333333;
            padding: 15px 10px;
            line-height: 1.4;
        }

        /* 顶部信息区 */
        .header {
            margin-bottom: 25px;
        }

        /* 顶部栏容器核心样式 */
        .header-bar {
            width: 100%;
            height: 80px;
            background-color: #8BC34A; /* 浅黄绿色背景 */
            border-radius: 12px 0 0 12px; /* 左上、左下圆角12px，右侧直角 */
            padding: 15px;
            box-sizing: border-box; /* 内边距计入宽高 */
            display: flex; /* Flex布局实现水平排列 */
            align-items: center; /* 垂直居中 */
            justify-content: space-between; /* 子元素两端分布 */
            position: relative; /* 用于定位底部数据区 */
            overflow: hidden; /* 防止内容溢出 */
        }

        /* Logo区域 */
        .header-logo {
            width: 40px;
            height: 40px;
            margin-right: 20px;
            flex-shrink: 0;
        }
        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* 保持Logo比例 */
        }

        /* 中间标题区域 */
        .header-title {
            text-align: center;
            color: #FFFFFF; /* 白色文字 */
            flex: 1; /* 占满剩余空间，实现居中 */
        }
        .main-title {
            font-size: 20px;
            font-weight: bold;
            margin: 0;
            line-height: 1.2;
        }
        .sub-title {
            font-size: 14px;
            margin: 5px 0 0 0;
            line-height: 1.2;
        }

        /* 右侧信息区域 */
        .header-info {
            color: #FFFFFF; /* 白色文字 */
            text-align: right;
            flex-shrink: 0;
        }
        .date-text {
            font-size: 14px;
            margin: 0;
        }
        .update-text {
            font-size: 12px;
            margin: 3px 0 0 0;
        }

        /* 周报内容区域 */
        .report-content {
            margin-bottom: 25px;
        }

        .report-title {
            font-size: 18px;
            font-weight: bold;
            color: #333333;
            margin-bottom: 15px;
        }

        .report-summary {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .summary-title {
            font-size: 16px;
            font-weight: bold;
            color: #333333;
            margin-bottom: 10px;
        }

        .summary-text {
            font-size: 14px;
            color: #666666;
            line-height: 1.6;
        }

        /* 数据卡片 */
        .data-card {
            background-color: #ffffff;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 16px;
            font-weight: bold;
            color: #333333;
        }

        .card-unit {
            font-size: 13px;
            color: #666666;
        }

        .card-data {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 8px;
        }

        .price-value {
            font-size: 18px;
            font-weight: bold;
            color: #222222;
        }

        .price-change {
            font-size: 14px;
        }

        .price-change.up {
            color: #e53935;
        }

        .price-change.down {
            color: #2e7d32;
        }

        .price-change.flat {
            color: #000000;
        }

        .price-ratio {
            font-size: 12px;
        }

        .price-ratio.up {
            color: #e53935;
        }

        .price-ratio.down {
            color: #2e7d32;
        }

        .price-ratio.flat {
            color: #000000;
        }

        .card-detail {
            font-size: 13px;
            color: #666666;
            line-height: 1.6;
            padding-top: 8px;
            border-top: 1px solid #f0f0f0;
        }

        /* 底部说明区域 */
        .footer-section {
            margin-top: 30px;
            padding: 20px 10px;
            border-top: 1px solid #e5e5e5;
        }

        .explanation-text {
            font-size: 12px;
            color: #666666;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        /* 底部导航栏 */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 15px 0;
            border-top: 1px solid #e5e5e5;
            position: sticky;
            bottom: 0;
            background-color: #ffffff;
        }

        .nav-item {
            text-align: center;
            flex: 1;
        }

        .nav-item span {
            font-size: 14px;
            color: #333333;
            font-weight: normal;
        }

        .nav-item.active span {
            color: #8BC34A;
            font-weight: bold;
        }

        /* 响应式适配 - 手机端竖屏单列布局 */
        @media (max-width: 374px) {
            body {
                padding: 15px 10px;
            }

            /* 顶部栏响应式调整 */
            .header-bar {
                height: 100px;
                padding: 10px;
            }

            .header-logo {
                width: 35px;
                height: 35px;
                margin-right: 10px;
            }

            .main-title {
                font-size: 18px;
            }

            .sub-title {
                font-size: 12px;
            }

            .header-info {
                margin-left: auto;
            }

            .date-text {
                font-size: 12px;
            }

            .update-text {
                font-size: 10px;
            }

            .report-title {
                font-size: 16px;
            }

            .summary-title {
                font-size: 15px;
            }

            .summary-text {
                font-size: 13px;
            }

            .card-title {
                font-size: 15px;
            }

            .card-unit {
                font-size: 12px;
            }

            .price-value {
                font-size: 16px;
            }

            .price-change {
                font-size: 13px;
            }

            .card-detail {
                font-size: 12px;
            }

            .footer-section {
                margin-top: 20px;
                padding: 15px 10px;
            }

            .explanation-text {
                font-size: 11px;
            }

            .bottom-nav {
                padding: 12px 0;
            }

            .nav-item span {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- 顶部栏模块 -->
    <div class="header">
        <div class="header-bar">
            <!-- Logo区域 -->
            <div class="header-logo">
                <img src="out/安佑心科技LOGO.png" alt="安佑心科技LOGO">
            </div>

            <!-- 中间标题区域 -->
            <div class="header-title">
                <h1 class="main-title">每周周报</h1>
                <p class="sub-title">Weekly Report</p>
            </div>

            <!-- 右侧信息区域 -->
            <div class="header-info">
                <p class="date-text">2026-01-14</p>
                <p class="update-text">每周一更新</p>
            </div>
        </div>
    </div>

    <!-- 周报内容区域 -->
    <div class="report-content">
        <h2 class="report-title">本周市场总结</h2>

        <div class="report-summary">
            <div class="summary-title">本周行情概述</div>
            <div class="summary-text">
                本周（1月8日-1月14日）畜牧市场整体呈现震荡调整态势。生猪价格小幅下跌，仔猪价格稳步上涨，鸡蛋和淘汰鸡价格继续走弱。原料方面，玉米价格持续下行，豆粕价格跌幅扩大。整体来看，市场需求疲软，供应相对充足，预计短期内行情仍将维持弱势震荡格局。
            </div>
        </div>

        <!-- 生猪数据卡片 -->
        <div class="data-card">
            <div class="card-header">
                <span class="card-title">生猪</span>
                <span class="card-unit">元/公斤</span>
            </div>
            <div class="card-data">
                <span class="price-value">12.50</span>
                <span class="price-change down">-0.01</span>
                <span class="price-ratio down">(-0.08%)</span>
            </div>
            <div class="card-detail">
                本周生猪价格整体小幅下跌，周均价格12.50元/公斤，环比下跌0.08%。北方地区跌幅相对较大，南方地区相对稳定。终端消费需求疲软，供应端压力仍存，短期行情或继续偏弱运行。
            </div>
        </div>

        <!-- 仔猪数据卡片 -->
        <div class="data-card">
            <div class="card-header">
                <span class="card-title">仔猪</span>
                <span class="card-unit">元/公斤</span>
            </div>
            <div class="card-data">
                <span class="price-value">20.36</span>
                <span class="price-change up">+0.13</span>
                <span class="price-ratio up">(+0.64%)</span>
            </div>
            <div class="card-detail">
                仔猪价格本周稳步上涨，周均价格20.36元/公斤，环比上涨0.64%。养殖户补栏积极性有所恢复，市场供应略显紧张，支撑仔猪价格稳步走高。
            </div>
        </div>

        <!-- 鸡蛋数据卡片 -->
        <div class="data-card">
            <div class="card-header">
                <span class="card-title">鸡蛋</span>
                <span class="card-unit">元/公斤</span>
            </div>
            <div class="card-data">
                <span class="price-value">7.04</span>
                <span class="price-change down">-0.27</span>
                <span class="price-ratio down">(-3.69%)</span>
            </div>
            <div class="card-detail">
                鸡蛋价格本周继续走弱，周均价格7.04元/公斤，环比下跌3.69%。消费端需求清淡，蛋鸡存栏量较高，市场供应充足，短期行情或继续下行。
            </div>
        </div>

        <!-- 淘汰鸡数据卡片 -->
        <div class="data-card">
            <div class="card-header">
                <span class="card-title">淘汰鸡</span>
                <span class="card-unit">元/公斤</span>
            </div>
            <div class="card-data">
                <span class="price-value">10.52</span>
                <span class="price-change down">-0.45</span>
                <span class="price-ratio down">(-4.10%)</span>
            </div>
            <div class="card-detail">
                淘汰鸡价格本周跌幅扩大，周均价格10.52元/公斤，环比下跌4.10%。屠宰企业收购积极性不高，养殖户出栏意愿增强，市场供大于求格局明显。
            </div>
        </div>

        <!-- 玉米数据卡片 -->
        <div class="data-card">
            <div class="card-header">
                <span class="card-title">玉米</span>
                <span class="card-unit">元/吨</span>
            </div>
            <div class="card-data">
                <span class="price-value">2319</span>
                <span class="price-change down">-5</span>
                <span class="price-ratio down">(-0.21%)</span>
            </div>
            <div class="card-detail">
                玉米价格本周持续下行，周均价2319元/吨，环比下跌0.21%。新粮上市压力增大，下游企业采购谨慎，市场供给宽松，短期行情或继续偏弱调整。
            </div>
        </div>

        <!-- 豆粕数据卡片 -->
        <div class="data-card">
            <div class="card-header">
                <span class="card-title">豆粕</span>
                <span class="card-unit">元/吨</span>
            </div>
            <div class="card-data">
                <span class="price-value">3245</span>
                <span class="price-change down">-15</span>
                <span class="price-ratio down">(-0.46%)</span>
            </div>
            <div class="card-detail">
                豆粕价格本周跌幅扩大，周均价3245元/吨，环比下跌0.46%。美盘豆类走弱，国内油厂开机率维持高位，市场供应充足，需求端未见明显好转，预计短期行情仍将偏弱运行。
            </div>
        </div>
    </div>

    <!-- 底部说明区域 -->
    <div class="footer-section">
        <div class="explanation-text">数据来源于博亚和讯、猪好多网、玄田数据等专业畜牧网站，价格仅供参考，实际交易请以当地市场为准。</div>
        <div class="explanation-text">每周一上午9:00更新上周数据，为本周市场决策提供参考依据。</div>
        <div class="explanation-text">专业化、自动化、可视化的畜牧饲料原料市场行情信息平台，安佑集团预混料事业部市场部发布。</div>
    </div>

    <!-- 底部导航栏 -->
    <div class="bottom-nav">
        <div class="nav-item">
            <span>每日行情</span>
        </div>
        <div class="nav-item active">
            <span>每周周报</span>
        </div>
        <div class="nav-item">
            <span>我的</span>
        </div>
    </div>
</body>
        <script>
        // 配置：GitHub用户名
        const GITHUB_USERNAME = 'rexlhb';
        const REPO_NAME = 'anyu-market-data';

        // 从GitHub获取历史数据
        async function fetchMarketHistory() {
            try {
                const url = `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/${REPO_NAME}@main/backend/weekly_report_index.json`;
                const response = await fetch(url);

                if (!response.ok) {
                    console.warn('未找到历史数据文件');
                    return null;
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('获取历史数据失败:', error);
                return null;
            }
        }

        // 计算周均价和涨跌
        function calculateWeeklyData(history, weekStart, weekEnd, lastWeekStart, lastWeekEnd) {
            const products = ['生猪', '仔猪', '鸡蛋', '淘汰鸡', '玉米', '豆粕'];
            const currentWeekData = {};
            const lastWeekData = {};
            const changes = {};

            // 获取本周数据
            const current = new Date(weekStart);
            while (current <= new Date(weekEnd)) {
                const dateStr = current.toISOString().split('T')[0];
                if (history[dateStr] && history[dateStr].products) {
                    for (const product of products) {
                        if (!currentWeekData[product]) {
                            currentWeekData[product] = [];
                        }
                        const price = history[dateStr].products[product]?.price;
                        if (price !== null && price !== undefined) {
                            currentWeekData[product].push(price);
                        }
                    }
                }
 current.setDate(current.getDate() + 1);
            }

            // 获取上周数据
            const last = new Date(lastWeekStart);
            while (last <= new Date(lastWeekEnd)) {
                const dateStr = last.toISOString().split('T')[0];
                if (history[dateStr] && history[dateStr].products) {
                    for (const product of products) {
                        if (!lastWeekData[product]) {
                            lastWeekData[product] = [];
                        }
                        const price = history[dateStr].products[product]?.price;
                        if (price !== null && price !== undefined) {
                            lastWeekData[product].push(price);
                                           }
                }
                last.setDate(last.getDate() + 1);
            }

            // 计算平均值和涨跌
            for (const product of products) {
                const currentAvg = currentWeekData[product].length > 0
                    ? currentWeekData[product].reduce((a, b) => a + b, 0) / currentWeekData[product].length
                    : null;
                const lastAvg = lastWeekData[product].length > 0
                    ? lastWeekData[product].reduce((a, b) => a + b, 0) / lastWeekData[product].length
                    : null;

                if (currentAvg !== null && lastAvg !== null) {
                    changes[product] = {
                        price: currentAvg,
                        change: currentAvg - lastAvg,
                        percent: ((current - lastAvg) / lastAvg) * 100
                    };
                } else {
                    changes[product] = null;
                }
            }

            return changes;
        }

        // 格式化价格
        function formatPrice(product, price) {
            if (price === null) return '无数据';

            decimalProducts = ['生猪', '仔猪', '鸡蛋', '淘汰鸡'];
            const integerProducts = ['玉米', '豆粕'];

            if (decimalProducts.includes(product)) {
                return price.toFixed(2);
            } else if (integerProducts.includes(product)) {
                return Math.round(price);
            } else {
                return price.toFixed(2);
            }
        }

        // 格式化涨跌
        function formatChange(product, change, percent) {
            if (change === null) return { change: '无数据', percent: '无数据', class: 'flat' };

            const decimalProducts = ['生猪', '仔猪', '鸡蛋', '淘汰鸡'];
            const changeStr = change > 0
                ? `+${decimalProducts.includes(product) ? change.toFixed(2) : Math.round(change)}`
                : (decimalProducts.includes(product) ? change.toFixed(2) : Math.round(change));
            const percentStr = percent > 0
                ? `(+${percent.toFixed(2)}%)`
                : `(${percent.toFixed(2)}%)`;
            const classStr = change > 0 ? 'up' : (change < 0 ? 'down' : 'flat');

            return { change: changeStr, percent: percentStr, class: classStr };
        }

        // 更新页面数据
        function updatePageData(weeklyData, weekStart, weekEnd) {
            // 更新顶部日期
            const dateText = document.querySelector('.date-text');
            if (dateText) {
                dateText.textContent = weekStart;
            }

            // 更新各品类数据
            const products = ['生猪', '仔猪', '鸡蛋', '淘汰鸡', '玉米', '豆粕'];
            const cards = document.querySelectorAll('.data-card');

            products.forEach((product, index) => {
                const card = cards[index];
                if (!card || !weeklyData[]) return;

                const data = weeklyData[product];
                const priceValue = card.querySelector('.price-value');
                const priceChange = card.querySelector('.price-change');
                const priceRatio = card.querySelector('.price-ratio');

                // 更新价格
                if (priceValue) {
                    priceValue.textContent = formatPrice(product, data.price);
                }

                // 更新涨跌
                if (priceChange && priceRatio) {
                    const change = formatChange(product, data.change, data.percent);
                    priceChange.textContent = change.change;
                    priceChange.className = `price-change ${change.class}`;
                    priceRatio.textContent = change.percent;
                    priceRatio.className = `price-ratio ${change.class}`;
                }
            });
        }

        // 获取本周和上周日期范围
        function getWeekRanges() {
            const today = new Date();
            const day = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);

            const lastWeekSunday = new Date(monday);
            lastWeekSunday.setDate(monday.getDate() - 1);
            const lastWeekMonday = new Date(lastWeekSunday);
            lastWeekMonday.setDate(lastWeekSunday.getDate() - 6);

            return {
                weekStart: monday.toISOString().split('T')[0],
                weekEnd: sunday.toISOString().split('T')[0],
                lastWeekStart: lastWeekMonday.toISOString().split('T')[0],
                lastWeekEnd: lastWeekSunday.toISOString().split('T')[0]
            };
        }

        // 初始化页面
        async function initPage() {
            console.log('开始加载周报数据...');

            const ranges = getWeekRanges();
            const history = await fetchMarketHistory();

            if (!history || Object.keys(history).length === 0) {
                console.warn('无法加载历史数据，使用示例数据');
                return;
            }

            const weeklyData = calculateWeeklyData(
                history,
                ranges.weekStart,
                ranges.weekEnd,
                ranges.lastWeekStart,
                ranges.lastWeekEnd
            );

            updatePageData(weeklyData, ranges.weekSt
</html>
